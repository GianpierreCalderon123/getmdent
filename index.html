<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Getm Dent Game</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background: #0b1020;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: #fff;
    }

    #game-container {
      width: 400px;
      max-width: 100vw;
      height: 700px;
      max-height: 100vh;
      border-radius: 20px;
      overflow: hidden;
      position: relative;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.7);
      background: #8fd3ff;
    }

    #game-area {
      position: absolute;
      inset: 0;
      overflow: hidden;
      background: linear-gradient(#bde7ff, #e6f7ff);

      /* IMPORTANTE PARA T√ÅCTIL */
      touch-action: none;
      user-select: none;
    }

    #hud {
      position: absolute;
      top: 8px;
      left: 10px;
      right: 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 14px;
      z-index: 5;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.7);
    }

    #hud span {
      margin-right: 8px;
    }

    #message {
      font-size: 12px;
      opacity: 0.9;
    }

    /* Fachada Getm Dent */
    #clinic-front {
      position: absolute;
      bottom: 120px;
      left: 0;
      width: 100%;
      height: 220px;
      background: #f6f8ff;
      border-top: 8px solid #ffb347;
      border-bottom: 8px solid #ffb347;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }

    #clinic-sign {
      margin-top: 10px;
      padding: 4px 18px;
      border-radius: 14px;
      background: #008dcf;
      color: #fff;
      font-weight: 700;
      letter-spacing: 0.12em;
      font-size: 14px;
      box-shadow: 0 4px 0 #005a83;
      text-transform: uppercase;
    }

    #door {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 120px;
      background: #c0ddff;
      border: 4px solid #7ea7d9;
      border-radius: 8px 8px 0 0;
    }

    #street {
      position: absolute;
      bottom: 0;
      width: 100%;
      height: 120px;
      background: linear-gradient(#d3d3d3, #7c7c7c);
    }

    #street::before {
      content: "";
      position: absolute;
      top: 18px;
      left: 0;
      right: 0;
      height: 6px;
      background: repeating-linear-gradient(
        to right,
        #fdfdfd 0,
        #fdfdfd 40px,
        transparent 40px,
        transparent 60px
      );
      opacity: 0.7;
    }

    /* Personaje (paciente) */
    #patient {
      position: absolute;
      bottom: 120px;
      width: 60px;
      height: 95px;
      transform: translateX(-50%);
      left: 50%;
      z-index: 3;
    }

    .chibi {
      position: relative;
      width: 100%;
      height: 100%;
    }

    .chibi .head {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 46px;
      height: 46px;
      background: #ffdfc4;
      border-radius: 50%;
      box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.05);
    }

    .chibi .body {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 50px;
      height: 54px;
      background: #4aa6ff;
      border-radius: 12px 12px 12px 12px;
    }

    .chibi .eyes {
      position: absolute;
      top: 18px;
      left: 50%;
      transform: translateX(-50%);
      width: 26px;
      display: flex;
      justify-content: space-between;
      font-size: 8px;
    }

    .chibi .mouth {
      position: absolute;
      top: 29px;
      left: 50%;
      transform: translateX(-50%);
      width: 16px;
      height: 7px;
      border-radius: 0 0 12px 12px;
      background: #e57f7f;
    }

    .chibi .legs {
      position: absolute;
      bottom: -4px;
      left: 50%;
      transform: translateX(-50%);
      width: 34px;
      height: 10px;
      display: flex;
      justify-content: space-between;
    }

    .chibi .legs span {
      flex: 1;
      margin: 0 1px;
      border-radius: 4px;
      background: #2d6fa8;
    }

    /* Doctor gordito con lentes */
    .doctor-main .body {
      background: #1f9ad0;
    }

    .doctor-main .beard {
      position: absolute;
      bottom: 8px;
      left: 50%;
      transform: translateX(-50%);
      width: 30px;
      height: 16px;
      border-radius: 0 0 20px 20px;
      background: #2b1b19;
    }

    .doctor-main .hair {
      position: absolute;
      top: -4px;
      left: 50%;
      transform: translateX(-50%);
      width: 42px;
      height: 20px;
      border-radius: 16px 16px 8px 8px;
      background: #2b1b19;
    }

    .doctor-main .glasses {
      position: absolute;
      top: 18px;
      left: 50%;
      transform: translateX(-50%);
      width: 28px;
      height: 10px;
      border-radius: 6px;
      border: 2px solid #ffffff;
      background: rgba(255, 255, 255, 0.2);
    }

    .doctor-main .eyes {
      top: 20px;
    }

    /* Doctora estilo invitaci√≥n */
    .doctor-female .hair {
      position: absolute;
      top: -8px;
      left: 50%;
      transform: translateX(-50%);
      width: 50px;
      height: 38px;
      border-radius: 22px;
      background: #8d4b28;
      box-shadow: 0 0 0 4px #8d4b28;
    }

    .doctor-female .body {
      background: #2fb8d1;
    }

    /* Items que caen */
    .falling-item {
      position: absolute;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
      top: -50px;
      z-index: 2;
    }

    .falling-item.good {
      background: #5dd37b;
    }

    .falling-item.bad {
      background: #ff6666;
    }

    /* Overlay final Getm Dent */
    #overlay {
      position: absolute;
      inset: 0;
      background: rgba(12, 16, 35, 0.83);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.4s ease;
      z-index: 10;
    }

    #overlay.visible {
      opacity: 1;
      pointer-events: auto;
    }

    #overlay-card {
      background: #f8fbff;
      color: #1b2840;
      border-radius: 18px;
      padding: 18px 18px 16px;
      width: 90%;
      max-width: 320px;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
    }

    #overlay-title {
      font-size: 20px;
      margin-bottom: 6px;
    }

    #overlay-msg {
      font-size: 14px;
      margin-top: 4px;
      margin-bottom: 10px;
    }

    #doctors-wrapper {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 8px;
    }

    .small-chibi {
      width: 70px;
      height: 105px;
    }

    #restart-btn {
      margin-top: 6px;
      padding: 6px 14px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #00b894, #0984e3);
      color: white;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    }

    #restart-btn:hover {
      transform: translateY(-1px);
    }

    #restart-btn:active {
      transform: translateY(0);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
    }

    /* Hint controles */
    #hint {
      position: absolute;
      bottom: 6px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 11px;
      opacity: 0.85;
      z-index: 6;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
    }
  </style>
</head>
<body>
  <div id="game-container">
    <div id="game-area">
      <div id="hud">
        <div>
          <span>Puntos: <strong id="score">0</strong></span>
          <span>Vidas: <strong id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</strong></span>
        </div>
        <div id="message">Atrapa cepillos ü™•, evita caries ü¶†</div>
      </div>

      <div id="clinic-front">
        <div id="clinic-sign">GETM DENT</div>
        <div id="door"></div>
      </div>
      <div id="street"></div>

      <!-- Paciente -->
      <div id="patient">
        <div class="chibi">
          <div class="head">
            <div class="eyes">
              <span>‚óâ</span><span>‚óâ</span>
            </div>
            <div class="mouth"></div>
          </div>
          <div class="body"></div>
          <div class="legs">
            <span></span><span></span>
          </div>
        </div>
      </div>

      <div id="hint">Usa ‚Üê ‚Üí / A D o arrastra con el dedo</div>

      <!-- Overlay con doctores tipo invitaci√≥n -->
      <div id="overlay">
        <div id="overlay-card">
          <div id="doctors-wrapper">
            <div class="chibi doctor-female small-chibi">
              <div class="head">
                <div class="hair"></div>
                <div class="eyes">
                  <span>‚óâ</span><span>‚óâ</span>
                </div>
                <div class="mouth"></div>
              </div>
              <div class="body"></div>
              <div class="legs">
                <span></span><span></span>
              </div>
            </div>
            <div class="chibi doctor-main small-chibi">
              <div class="head">
                <div class="hair"></div>
                <div class="glasses"></div>
                <div class="eyes">
                  <span>‚óâ</span><span>‚óâ</span>
                </div>
                <div class="mouth"></div>
                <div class="beard"></div>
              </div>
              <div class="body"></div>
              <div class="legs">
                <span></span><span></span>
              </div>
            </div>
          </div>
          <h2 id="overlay-title">¬°Visita a Getm Dent!</h2>
          <p id="overlay-msg"></p>
          <button id="restart-btn">Volver a jugar</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const gameArea = document.getElementById("game-area");
    const patient = document.getElementById("patient");
    const scoreEl = document.getElementById("score");
    const livesEl = document.getElementById("lives");
    const overlay = document.getElementById("overlay");
    const overlayMsg = document.getElementById("overlay-msg");
    const restartBtn = document.getElementById("restart-btn");

    let patientX = 0;
    const patientWidth = 60;
    const patientSpeed = 6;

    let moveDirection = 0; // -1 izquierda, 1 derecha (teclado)
    let items = [];
    let score = 0;
    let lives = 3;
    let lastSpawnTime = 0;
    let lastFrameTime = 0;
    const spawnInterval = 900; // ms
    const targetScore = 10;
    let phase = "game"; // game | ended

    // Variables para t√°ctil
    let isTouching = false;
    let touchStartX = 0;
    let patientStartX = 0;

    function updateLivesDisplay() {
      const full = "‚ù§Ô∏è".repeat(lives);
      const empty = "ü©∂".repeat(Math.max(0, 3 - lives));
      livesEl.textContent = full + empty;
    }

    function spawnItem() {
      const itemEl = document.createElement("div");
      const isGood = Math.random() > 0.4; // m√°s prob de buenos
      itemEl.classList.add("falling-item");
      itemEl.classList.add(isGood ? "good" : "bad");
      itemEl.textContent = isGood ? "ü™•" : "ü¶†";
      const maxX = gameArea.clientWidth - 40;
      const x = Math.random() * maxX;
      itemEl.style.left = x + "px";
      gameArea.appendChild(itemEl);

      items.push({
        el: itemEl,
        x,
        y: -40,
        speed: 3 + Math.random() * 1.5,
        type: isGood ? "good" : "bad",
      });
    }

    function checkCollision(a, b) {
      const ra = a.getBoundingClientRect();
      const rb = b.getBoundingClientRect();
      return !(
        ra.right < rb.left ||
        ra.left > rb.right ||
        ra.bottom < rb.top ||
        ra.top > rb.bottom
      );
    }

    function endGame(success) {
      phase = "ended";
      overlay.classList.add("visible");
      if (success) {
        overlayMsg.textContent =
          "Entraste a Getm Dent, el doctor gordito con lentes y su compa√±era te atendieron s√∫per bien. ¬°Saliste con la sonrisa m√°s feliz del mundo! üòÅü¶∑";
      } else {
        overlayMsg.textContent =
          "Ups, demasiadas caries te alcanzaron antes de llegar a Getm Dent. Int√©ntalo otra vez y cuida esos dientes. üí™";
      }
    }

    function resetGame() {
      items.forEach((it) => it.el.remove());
      items = [];
      score = 0;
      lives = 3;
      scoreEl.textContent = score;
      updateLivesDisplay();
      overlay.classList.remove("visible");
      phase = "game";
      lastSpawnTime = 0;
      lastFrameTime = 0;
      patientX = (gameArea.clientWidth - patientWidth) / 2;
      patient.style.left = patientX + "px";
      requestAnimationFrame(gameLoop);
    }

    function gameLoop(timestamp) {
      if (phase !== "game") return;

      if (!lastFrameTime) lastFrameTime = timestamp;
      const delta = timestamp - lastFrameTime;
      lastFrameTime = timestamp;

      // mover paciente con teclado (si no se est√° usando t√°ctil)
      if (!isTouching) {
        const maxX = gameArea.clientWidth - patientWidth;
        patientX += moveDirection * patientSpeed;
        if (patientX < 0) patientX = 0;
        if (patientX > maxX) patientX = maxX;
        patient.style.left = patientX + "px";
      }

      // spawn
      if (timestamp - lastSpawnTime > spawnInterval) {
        spawnItem();
        lastSpawnTime = timestamp;
      }

      // actualizar items
      for (let i = items.length - 1; i >= 0; i--) {
        const item = items[i];
        item.y += item.speed * (delta / 16.67);
        item.el.style.top = item.y + "px";

        // fuera de pantalla
        if (item.y > gameArea.clientHeight + 60) {
          item.el.remove();
          items.splice(i, 1);
          continue;
        }

        // colisi√≥n
        if (checkCollision(item.el, patient)) {
          if (item.type === "good") {
            score++;
            scoreEl.textContent = score;
          } else {
            lives--;
            updateLivesDisplay();
            if (lives <= 0) {
              item.el.remove();
              items.splice(i, 1);
              endGame(false);
              return;
            }
          }
          item.el.remove();
          items.splice(i, 1);
        }
      }

      // victoria
      if (score >= targetScore) {
        endGame(true);
        return;
      }

      requestAnimationFrame(gameLoop);
    }

    // CONTROLES TECLADO
    document.addEventListener("keydown", (e) => {
      if (e.key === "ArrowLeft" || e.key === "a" || e.key === "A") {
        moveDirection = -1;
      } else if (e.key === "ArrowRight" || e.key === "d" || e.key === "D") {
        moveDirection = 1;
      }
    });

    document.addEventListener("keyup", (e) => {
      if (
        (e.key === "ArrowLeft" || e.key === "a" || e.key === "A") &&
        moveDirection === -1
      ) {
        moveDirection = 0;
      } else if (
        (e.key === "ArrowRight" || e.key === "d" || e.key === "D") &&
        moveDirection === 1
      ) {
        moveDirection = 0;
      }
    });

    // CONTROLES T√ÅCTILES (arrastrar personaje)
    function handleTouchStart(e) {
      if (phase !== "game") return;
      const touch = e.touches[0];
      const rect = gameArea.getBoundingClientRect();
      const xInside = touch.clientX - rect.left;

      isTouching = true;
      touchStartX = xInside;
      patientStartX = patientX;
    }

    function handleTouchMove(e) {
      if (!isTouching || phase !== "game") return;
      const touch = e.touches[0];
      const rect = gameArea.getBoundingClientRect();
      const xInside = touch.clientX - rect.left;

      const dx = xInside - touchStartX;
      const maxX = gameArea.clientWidth - patientWidth;
      patientX = patientStartX + dx;
      if (patientX < 0) patientX = 0;
      if (patientX > maxX) patientX = maxX;
      patient.style.left = patientX + "px";

      e.preventDefault(); // evita scroll
    }

    function handleTouchEnd() {
      isTouching = false;
    }

    gameArea.addEventListener("touchstart", handleTouchStart, { passive: false });
    gameArea.addEventListener("touchmove", handleTouchMove, { passive: false });
    gameArea.addEventListener("touchend", handleTouchEnd);
    gameArea.addEventListener("touchcancel", handleTouchEnd);

    restartBtn.addEventListener("click", resetGame);

    window.addEventListener("load", () => {
      patientX = (gameArea.clientWidth - patientWidth) / 2;
      patient.style.left = patientX + "px";
      updateLivesDisplay();
      requestAnimationFrame(gameLoop);
    });
  </script>
</body>
</html>

